import{_ as Z}from"./Layout.vue_vue_type_script_setup_true_lang.e42cc68e.js";import{v as G,f as b,x as S,y as J,z as K,A as Q,j as I,e as j,r as v,o as c,c as p,b as l,a as h,w as o,m as A,d as k,u as W,q as a,g as w,B as F,C as $,F as O,h as H,t as f,s as X}from"./index.438ae0bc.js";import"./strategio.04befae5.js";const q=G("datagrid",()=>{const s=b(!0),r=b({currentPage:1,lastPage:1}),d=b([]),u=b([]),t=b(),e=b(!1);return{loading:s,page:r,items:d,selectedItems:u,selectedItem:t,checkedAll:e}}),Y=s=>{const r=q(),{checkedAll:d,loading:u,selectedItems:t,items:e,page:n}=S(r);async function g(){u.value=!0,e.value=[],t.value=[];const _=await I.collections.show(s,{currentPage:n.value.currentPage,itemsPerPage:15});n.value={currentPage:_.data.currentPage,lastPage:_.data.lastPage},_.data.lastPage<n.value.currentPage&&n.value.currentPage>1&&(n.value.currentPage=_.data.lastPage),e.value=_.data.items,u.value=!1}return J(()=>n.value.currentPage,()=>g()),K(()=>{e.value.length!==0&&(d.value=t.value.length===e.value.length)}),Q(()=>g()),{store:r,refresh:g}},ee={class:"d-flex justify-space-between align-center"},te={class:"d-flex ms-3"},ae=j({__name:"DatagridHeader",props:{breadcrumbItems:null,refresh:null},setup(s){return(r,d)=>{const u=v("v-breadcrumbs"),t=v("v-btn"),e=v("v-tooltip");return c(),p("div",ee,[l(u,{items:s.breadcrumbItems,class:"pa-0",style:{"font-size":"1.4rem"}},null,8,["items"]),h("div",te,[l(e,{location:"top",text:"Obnovit data",offset:"-5"},{activator:o(({props:n})=>[l(t,A(n,{variant:"plain",icon:"mdi-refresh",size:"small",color:"",onClick:s.refresh}),null,16,["onClick"])]),_:1}),l(e,{location:"top",text:"Upravit kolekci",offset:"-5"},{activator:o(({props:n})=>[l(t,A(n,{variant:"plain",icon:"mdi-cog",size:"small",color:""}),null,16)]),_:1}),l(t,{variant:"tonal","prepend-icon":"mdi-plus",class:"ms-3"},{default:o(()=>[k(" P\u0159idat ")]),_:1})])])}}}),le=s=>{const r=s.date.split(" "),d=r[1].split("."),[u,t,e]=r[0].split("-"),[n,g,_]=d[0].split(":");return`${e}.${t}.${u} ${n}:${g}:${_}`},ne=()=>({toCzDateTime:le}),oe={class:"text-no-wrap"},se={style:{width:"90px"}},ie={class:"d-flex align-center"},ce=h("th",null,"ID",-1),re=h("th",{class:"text-right"},null,-1),ue={key:0},de=["href"],me=["href"],ve={key:2},pe={key:3},_e={key:1},ge={class:"text-right"},he=j({__name:"DatagridTable",props:{columns:null,batchActions:null,rowActions:null,routeDetailName:null},setup(s){const r=s,d=W(),u=q(),{checkedAll:t,items:e,selectedItems:n,selectedItem:g}=S(u),{toCzDateTime:_}=ne();function C(){n.value=t.value?[]:e.value}function E(R){d.push({name:r.routeDetailName,params:{id:R}})}return(R,x)=>{const P=v("v-checkbox"),D=v("v-btn"),T=v("v-list-item-title"),N=v("v-list-item"),V=v("v-list"),z=v("v-menu"),M=v("v-chip"),y=v("v-table");return a(e).length?(c(),w(y,{key:0,density:"default",hover:"",class:"mt-5"},{default:o(()=>[h("thead",null,[h("tr",oe,[h("th",se,[h("div",ie,[l(P,{onClick:C,modelValue:a(t),"onUpdate:modelValue":x[0]||(x[0]=m=>F(t)?t.value=m:null),color:"primary",class:"d-flex"},null,8,["modelValue"]),l(D,{icon:"mdi-dots-vertical",variant:"plain",size:"small",id:"menu-activator",disabled:a(n).length===0},null,8,["disabled"]),l(z,{activator:"#menu-activator"},{default:o(()=>[l(V,null,{default:o(()=>[(c(!0),p(O,null,$(s.batchActions,(m,i)=>(c(),w(N,{key:i,value:i,onClick:m.handler},{default:o(()=>[l(T,null,{default:o(()=>[k(f(m.title)+" ("+f(a(n).length)+"x) ",1)]),_:2},1024)]),_:2},1032,["value","onClick"]))),128))]),_:1})]),_:1})])]),ce,(c(!0),p(O,null,$(s.columns,m=>(c(),p("th",{key:m.key,class:"text-left"},f(m.name),1))),128)),re])]),h("tbody",null,[(c(!0),p(O,null,$(a(e),m=>(c(),p("tr",{key:m.id,class:"text-no-wrap"},[h("td",null,[l(P,{modelValue:a(n),"onUpdate:modelValue":x[1]||(x[1]=i=>F(n)?n.value=i:null),value:m,"value-comparator":(i,B)=>i.id===B.id,color:"primary",class:"d-flex"},null,8,["modelValue","value","value-comparator"])]),h("td",null,[l(M,{size:"small",color:"",style:{cursor:"pointer"},onClick:i=>E(m.id)},{default:o(()=>[k(f(m.id),1)]),_:2},1032,["onClick"])]),(c(!0),p(O,null,$(s.columns,i=>(c(),p("td",{key:i.key},[m[i.key]?(c(),p("div",ue,[i.type==="email"?(c(),p("a",{key:0,target:"_blank",href:`mailto:${m[i.key]}`},f(m[i.key]),9,de)):i.type==="phone"?(c(),p("a",{key:1,target:"_blank",href:`tel:${m[i.key]}`},f(m[i.key]),9,me)):i.type==="datetime"?(c(),p("span",ve,f(a(_)(m[i.key])),1)):(c(),p("span",pe,f(m[i.key]),1))])):(c(),p("div",_e,"-"))]))),128)),h("td",ge,[l(z,null,{activator:o(({props:i})=>[l(D,A({icon:"mdi-dots-vertical"},i,{size:"small",variant:"plain"}),null,16)]),default:o(()=>[l(V,null,{default:o(()=>[(c(!0),p(O,null,$(s.rowActions,(i,B)=>(c(),w(N,{key:B,value:B,onClick:Ee=>(g.value=m)&&i.handler()},{default:o(()=>[l(T,null,{default:o(()=>[k(f(i.title),1)]),_:2},1024)]),_:2},1032,["value","onClick"]))),128))]),_:2},1024)]),_:2},1024),l(D,{icon:"mdi-arrow-right",variant:"plain",size:"small",onClick:i=>E(m.id)},null,8,["onClick"])])]))),128))])]),_:1})):H("",!0)}}}),U=j({__name:"Modal",props:{title:null,open:null,loading:null,toggleOpen:null},emits:["accept","close"],setup(s,{emit:r}){const d=s;function u(){r("accept")}function t(){d.toggleOpen("hide"),r("close")}return(e,n)=>{const g=v("v-card-title"),_=v("v-card-text"),C=v("v-spacer"),E=v("v-btn"),R=v("v-card-actions"),x=v("v-card"),P=v("v-dialog");return c(),w(P,{"model-value":s.open.value,"max-width":500,scrollable:""},{default:o(()=>[l(x,null,{default:o(()=>[l(g,{class:"text-h5 mt-3 px-5 pt-5 pb-0"},{default:o(()=>[k(f(s.title),1)]),_:1}),l(_,{class:"py-3 px-5",style:{"max-height":"300px"}},{default:o(()=>[X(e.$slots,"default")]),_:3}),l(R,null,{default:o(()=>[l(C),l(E,{variant:"tonal",color:"",onClick:t},{default:o(()=>[k(" Zru\u0161it ")]),_:1}),l(E,{variant:"tonal",color:"error",loading:s.loading.value,onClick:u},{default:o(()=>[k(" Potvrdit ")]),_:1},8,["loading"])]),_:1})]),_:3})]),_:3},8,["model-value"])}}}),L=(s=!1)=>{const r=b(!1),d=b(s);function u(e){r.value=!1,d.value=e==="show"}function t(e){r.value=e==="show"}return{loading:r,open:d,toggleLoading:t,toggleOpen:u}},fe=(s,r,d,u)=>{const t=L(),e=L();async function n(){t.toggleLoading("show"),await I.collections.remove(s,[d.value.id]),t.toggleOpen("hide"),await r()}async function g(){e.toggleLoading("show"),await I.collections.remove("user",u.value.map(_=>_.id)),e.toggleOpen("hide"),await r()}return{mdlRemove:t,mdlBulkRemove:e,remove:n,bulkRemove:g}},ke=(s,r,d)=>{const u=L(),t=L();async function e(){u.toggleLoading("show"),await I.auth.revokeToken([r.value.id]),u.toggleOpen("hide"),await s()}async function n(){t.toggleLoading("show"),await I.auth.revokeToken(d.value.map(g=>g.id)),t.toggleOpen("hide"),await s()}return{mdlRevoke:u,mdlBulkRevoke:t,revoke:e,bulkRevoke:n}},ye={class:"font-weight-bold"},xe={class:"font-weight-bold"},be=h("div",{class:"mb-5"},"Opravdu si p\u0159ejete trvale odstranit tyto u\u017Eivatele?",-1),we=h("div",{class:"mb-5"},"Opravdu si p\u0159ejete odhl\xE1sit tyto u\u017Eivatele?",-1),Ae=j({__name:"Users",setup(s){const{store:r,refresh:d}=Y("user"),{items:u,page:t,selectedItems:e,selectedItem:n,loading:g}=S(r),{mdlRemove:_,mdlBulkRemove:C,remove:E,bulkRemove:R}=fe("user",d,n,e),{mdlRevoke:x,mdlBulkRevoke:P,revoke:D,bulkRevoke:T}=ke(d,n,e);return(N,V)=>{const z=v("v-chip"),M=v("v-pagination");return c(),w(Z,{loading:a(g)},{default:o(()=>[l(U,A(a(_),{onAccept:a(E),title:"Odstranit u\u017Eivatele"}),{default:o(()=>[k(" Opravdu si p\u0159ejete trvale odstranit u\u017Eivatele "),h("span",ye,f(a(n).email),1),k("? ")]),_:1},16,["onAccept"]),l(U,A(a(x),{onAccept:a(D),title:"Odhl\xE1sit u\u017Eivatele"}),{default:o(()=>[k(" Opravdu si p\u0159ejete odhl\xE1sit u\u017Eivatele "),h("span",xe,f(a(n).email),1),k("? ")]),_:1},16,["onAccept"]),l(U,A(a(C),{onAccept:a(R),title:`Odstranit u\u017Eivatele (${a(e).length}x)`}),{default:o(()=>[be,(c(!0),p(O,null,$(a(e).map(y=>y.email),y=>(c(),w(z,{class:"me-2 mb-2",size:"small"},{default:o(()=>[k(f(y),1)]),_:2},1024))),256))]),_:1},16,["onAccept","title"]),l(U,A(a(P),{onAccept:a(T),title:`Odhl\xE1sit u\u017Eivatele (${a(e).length}x)`}),{default:o(()=>[we,(c(!0),p(O,null,$(a(e).map(y=>y.email),y=>(c(),w(z,{class:"me-2 mb-2",size:"small"},{default:o(()=>[k(f(y),1)]),_:2},1024))),256))]),_:1},16,["onAccept","title"]),l(ae,{"breadcrumb-items":["U\u017Eivatel\xE9"],refresh:a(d)},null,8,["refresh"]),l(he,{columns:[{name:"Role",key:"role",type:"string"},{name:"E-mail",key:"email",type:"email"},{name:"Posledn\xED p\u0159ihl\xE1\u0161en\xED",key:"lastLogin",type:"datetime"},{name:"Expirace tokenu",key:"loginExpiration",type:"datetime"},{name:"Posledn\xED \xFAprava",key:"updatedAt",type:"datetime"},{name:"Registrace",key:"createdAt",type:"datetime"}],"batch-actions":[{title:"Odhl\xE1sit u\u017Eivatele",handler:()=>a(P).toggleOpen("show")},{title:"Trvale odstranit",handler:()=>a(C).toggleOpen("show")}],"row-actions":[{title:"Odhl\xE1sit u\u017Eivatele",handler:()=>a(x).toggleOpen("show")},{title:"Trvale odstranit",handler:()=>a(_).toggleOpen("show")}],"route-detail-name":"UserDetail"},null,8,["batch-actions","row-actions"]),a(u).length?(c(),w(M,{key:0,modelValue:a(t).currentPage,"onUpdate:modelValue":V[0]||(V[0]=y=>a(t).currentPage=y),length:a(t).lastPage,"total-visible":5,class:"mt-5"},null,8,["modelValue","length"])):H("",!0)]),_:1},8,["loading"])}}});export{Ae as default};
