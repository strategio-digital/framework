import{v as X,f as x,x as N,y as H,z as Y,A as K,j as I,e as U,r as v,o as i,c as h,b as o,a as p,w as s,m as R,d as k,q as u,g as w,B as q,C as D,F as A,h as B,t as y,s as Z,D as ee,E as te,i as G,n as J}from"./index.03e56193.js";import{_ as le}from"./Layout.vue_vue_type_script_setup_true_lang.f7a007cd.js";import"./strategio.82353edf.js";const Q=X("datagrid",()=>{const l=x(!0),d=x({currentPage:1,lastPage:1}),c=x([]),a=x([]),t=x(),e=x(!1);return{loading:l,page:d,items:c,selectedItems:a,selectedItem:t,checkedAll:e}}),oe=(l,d)=>{const c=Q(),{checkedAll:a,loading:t,selectedItems:e,items:r,page:n}=N(c);async function f(){t.value=!0,r.value=[],e.value=[];const g=await I.collections.show(l,{currentPage:n.value.currentPage,itemsPerPage:d});n.value={currentPage:g.data.currentPage,lastPage:g.data.lastPage},g.data.lastPage<n.value.currentPage&&n.value.currentPage>1&&(n.value.currentPage=g.data.lastPage),r.value=g.data.items,t.value=!1}return H(()=>n.value.currentPage,()=>f()),Y(()=>{r.value.length!==0&&(a.value=e.value.length===r.value.length)}),K(()=>f()),{store:c,refresh:f}},ne={class:"d-flex justify-space-between align-center"},ae={class:"d-flex ms-3"},se=U({__name:"DatagridHeader",props:{breadcrumbItems:null,refresh:null},setup(l){return(d,c)=>{const a=v("v-breadcrumbs"),t=v("v-btn"),e=v("v-tooltip");return i(),h("div",ne,[o(a,{items:l.breadcrumbItems,class:"pa-0",style:{"font-size":"1.4rem"}},null,8,["items"]),p("div",ae,[o(e,{location:"top",text:"Obnovit data",offset:"-5"},{activator:s(({props:r})=>[o(t,R(r,{variant:"plain",icon:"mdi-refresh",size:"small",color:"",onClick:l.refresh}),null,16,["onClick"])]),_:1}),o(e,{location:"top",text:"Upravit kolekci",offset:"-5"},{activator:s(({props:r})=>[o(t,R(r,{variant:"plain",icon:"mdi-cog",size:"small",color:""}),null,16)]),_:1}),o(t,{variant:"tonal","prepend-icon":"mdi-plus",class:"ms-3"},{default:s(()=>[k(" P\u0159idat ")]),_:1})])])}}}),ie=l=>{const d=l.date.split(" "),c=d[1].split("."),[a,t,e]=d[0].split("-"),[r,n,f]=c[0].split(":");return`${e}.${t}.${a} ${r}:${n}:${f}`},W=()=>({toCzDateTime:ie}),ce={class:"text-no-wrap"},ue={style:{width:"90px"}},de={class:"d-flex align-center"},re=p("th",null,"ID",-1),me=p("th",{class:"text-right"},null,-1),ve={key:0},pe=["href"],_e=["href"],he={key:2},ge={key:3},fe={key:1},ye={class:"text-right"},ke=U({__name:"DatagridTable",props:{columns:null,batchActions:null,rowActions:null},emits:["goToDetail"],setup(l,{emit:d}){const c=Q(),{checkedAll:a,items:t,selectedItems:e,selectedItem:r}=N(c),{toCzDateTime:n}=W();function f(){e.value=a.value?[]:t.value}function g(P){d("goToDetail",P)}return(P,$)=>{const b=v("v-checkbox"),E=v("v-btn"),O=v("v-list-item-title"),z=v("v-list-item"),C=v("v-list"),F=v("v-menu"),L=v("v-chip"),S=v("v-table");return u(t).length?(i(),w(S,{key:0,density:"default",hover:"",class:"mt-5"},{default:s(()=>[p("thead",null,[p("tr",ce,[p("th",ue,[p("div",de,[o(b,{onClick:f,modelValue:u(a),"onUpdate:modelValue":$[0]||($[0]=_=>q(a)?a.value=_:null),color:"primary",class:"d-flex"},null,8,["modelValue"]),o(E,{icon:"mdi-dots-vertical",variant:"plain",size:"small",id:"menu-activator",disabled:u(e).length===0},null,8,["disabled"]),o(F,{activator:"#menu-activator"},{default:s(()=>[o(C,null,{default:s(()=>[(i(!0),h(A,null,D(l.batchActions,(_,m)=>(i(),w(z,{key:m,value:m,onClick:_.handler},{default:s(()=>[o(O,null,{default:s(()=>[k(y(_.title)+" ("+y(u(e).length)+"x) ",1)]),_:2},1024)]),_:2},1032,["value","onClick"]))),128))]),_:1})]),_:1})])]),re,(i(!0),h(A,null,D(l.columns,_=>(i(),h("th",{key:_.key,class:"text-left"},y(_.name),1))),128)),me])]),p("tbody",null,[(i(!0),h(A,null,D(u(t),_=>(i(),h("tr",{key:_.id,class:"text-no-wrap"},[p("td",null,[o(b,{modelValue:u(e),"onUpdate:modelValue":$[1]||($[1]=m=>q(e)?e.value=m:null),value:_,"value-comparator":(m,T)=>m.id===T.id,color:"primary",class:"d-flex"},null,8,["modelValue","value","value-comparator"])]),p("td",null,[o(L,{size:"small",color:"",style:{cursor:"pointer"},onClick:m=>g(_.id)},{default:s(()=>[k(y(_.id),1)]),_:2},1032,["onClick"])]),(i(!0),h(A,null,D(l.columns,m=>(i(),h("td",{key:m.key},[_[m.key]?(i(),h("div",ve,[m.type==="email"?(i(),h("a",{key:0,target:"_blank",href:`mailto:${_[m.key]}`},y(_[m.key]),9,pe)):m.type==="phone"?(i(),h("a",{key:1,target:"_blank",href:`tel:${_[m.key]}`},y(_[m.key]),9,_e)):m.type==="datetime"?(i(),h("span",he,y(u(n)(_[m.key])),1)):(i(),h("span",ge,y(_[m.key]),1))])):(i(),h("div",fe,"-"))]))),128)),p("td",ye,[o(F,null,{activator:s(({props:m})=>[o(E,R({icon:"mdi-dots-vertical"},m,{size:"small",variant:"plain"}),null,16)]),default:s(()=>[o(C,null,{default:s(()=>[(i(!0),h(A,null,D(l.rowActions,(m,T)=>(i(),w(z,{key:T,value:T,onClick:V=>(r.value=_)&&m.handler()},{default:s(()=>[o(O,null,{default:s(()=>[k(y(m.title),1)]),_:2},1024)]),_:2},1032,["value","onClick"]))),128))]),_:2},1024)]),_:2},1024),o(E,{icon:"mdi-arrow-right",variant:"plain",size:"small",onClick:m=>g(_.id)},null,8,["onClick"])])]))),128))])]),_:1})):B("",!0)}}}),j=U({__name:"Modal",props:{title:null,open:null,loading:null,toggleOpen:null},emits:["accept","close"],setup(l,{emit:d}){const c=l;function a(){d("accept")}function t(){c.toggleOpen("hide"),d("close")}return(e,r)=>{const n=v("v-card-title"),f=v("v-card-text"),g=v("v-spacer"),P=v("v-btn"),$=v("v-card-actions"),b=v("v-card"),E=v("v-dialog");return i(),w(E,{modelValue:l.open.value,"onUpdate:modelValue":r[0]||(r[0]=O=>l.open.value=O),"max-width":500,onClose:t,scrollable:""},{default:s(()=>[o(b,null,{default:s(()=>[o(n,{class:"text-h5 mt-3 px-5 pt-5 pb-0"},{default:s(()=>[k(y(l.title),1)]),_:1}),o(f,{class:"py-3 px-5",style:{"max-height":"300px"}},{default:s(()=>[Z(e.$slots,"default")]),_:3}),o($,null,{default:s(()=>[o(g),o(P,{variant:"tonal",color:"",onClick:t},{default:s(()=>[k(" Zru\u0161it ")]),_:1}),o(P,{variant:"tonal",color:"error",loading:l.loading.value,onClick:a},{default:s(()=>[k(" Potvrdit ")]),_:1},8,["loading"])]),_:1})]),_:3})]),_:3},8,["modelValue"])}}}),M=(l=!1)=>{const d=x(!1),c=x(l);function a(e){d.value=!1,c.value=e==="show"}function t(e){d.value=e==="show"}return{loading:d,open:c,toggleLoading:t,toggleOpen:a}},be=(l,d,c,a)=>{const t=M(),e=M();async function r(){t.toggleLoading("show"),await I.collections.remove(l,[c.value.id]),t.toggleOpen("hide"),await d()}async function n(){e.toggleLoading("show"),await I.collections.remove("user",a.value.map(f=>f.id)),e.toggleOpen("hide"),await d()}return{mdlRemove:t,mdlBulkRemove:e,remove:r,bulkRemove:n}},xe=(l,d,c)=>{const a=M(),t=M();async function e(){a.toggleLoading("show"),await I.auth.revokeToken([d.value.id]),a.toggleOpen("hide"),await l()}async function r(){t.toggleLoading("show"),await I.auth.revokeToken(c.value.map(n=>n.id)),t.toggleOpen("hide"),await l()}return{mdlRevoke:a,mdlBulkRevoke:t,revoke:e,bulkRevoke:r}},we=["onKeyup","onClick"],Ee={class:"position-fixed h-100 bg-white side-modal-container"},$e={class:"position-absolute bg-white pa-3 rounded-s-xl side-modal-close"},Ce={class:"position-relative h-100 w-100"},Ve=U({__name:"SideModal",props:{opened:{type:Boolean}},emits:["close"],setup(l,{emit:d}){const c=l;function a(){d("close")}function t(e){e.key==="Escape"&&c.opened&&d("close")}return K(()=>document.addEventListener("keyup",t)),ee(()=>document.removeEventListener("keyup",t)),H(()=>c.opened,()=>{const e=document.querySelector("html");c.opened?(e.style.overflow="hidden",e.style.paddingRight="15px"):(e.style.removeProperty("overflow"),e.style.removeProperty("padding-right"))}),(e,r)=>{const n=v("v-btn");return i(),h("div",{onKeyup:te(a,["esc"]),onClick:G(a,["self"]),class:J(["position-fixed h-100 w-100 side-modal",{opened:l.opened}])},[p("div",Ee,[p("div",$e,[o(n,{onClick:a,icon:"mdi-close",color:"grey-darken-1",size:"x-small",style:{"margin-left":"3px"}})]),p("div",Ce,[Z(e.$slots,"default")])])],42,we)}}}),Pe=()=>{const l=x([]),d=t=>{l.value=t},c=t=>{l.value=l.value.map(e=>t[e.key]===void 0?e:{...e,value:t[e.key]?a(e.type,t[e.key]):null})},a=(t,e)=>t==="datetime"?W().toCzDateTime(e):e;return{createFormFields:d,setFormValues:c,formFields:l}},Ae=U({__name:"FormFields",props:{fields:null},setup(l){return(d,c)=>{const a=v("v-text-field"),t=v("v-select"),e=v("v-col"),r=v("v-row");return i(),w(r,{dense:""},{default:s(()=>[(i(!0),h(A,null,D(l.fields,(n,f)=>(i(),w(e,{cols:"12",key:f},{default:s(()=>[n.type==="text"||n.type==="datetime"?(i(),w(a,{key:0,disabled:n.disabled,label:n.label,modelValue:n.value,"onUpdate:modelValue":g=>n.value=g},null,8,["disabled","label","modelValue","onUpdate:modelValue"])):B("",!0),n.type==="select"?(i(),w(t,{key:1,label:n.label,disabled:n.disabled,modelValue:n.value,"onUpdate:modelValue":g=>n.value=g,items:n.items,"item-title":"label","item-value":"id","return-object":""},null,8,["label","disabled","modelValue","onUpdate:modelValue","items"])):B("",!0)]),_:2},1024))),128))]),_:1})}}}),Oe={class:"position-absolute w-100 h-100",style:{"z-index":"-1"}},De={class:"px-7 d-flex align-center border-b",style:{height:"100px"}},ze=p("h3",{class:"font-weight-light mb-0"},"Upravit polo\u017Eku",-1),Re={class:"text-grey",style:{"font-size":".8rem"}},Ue={class:"font-weight-bold"},Fe={class:"overflow-auto px-7 pt-5",style:{height:"calc(100% - 200px)"}},Te={class:"border-t d-flex align-center justify-end px-7",style:{height:"100px"}},Ie=U({__name:"CollectionForm",props:{id:null,collection:null},emits:["close"],setup(l,{emit:d}){const c=l,{createFormFields:a,setFormValues:t,formFields:e}=Pe(),r=x(!0),n=x(!1),f=x();async function g(){r.value=!0;const b=await I.collections.showOne(c.collection,{id:c.id});a([{type:"text",key:"email",label:"E-mail"},{type:"select",key:"role",label:"Role",items:[{id:"xyz",label:"Admin"},{id:"xyz",label:"Registered"}]},{type:"datetime",key:"createdAt",label:"Vytvo\u0159eno"},{type:"datetime",key:"updatedAt",label:"Naposledy upraveno",disabled:!0},{type:"datetime",key:"lastLogin",label:"Posledn\xED p\u0159ihl\xE1\u0161en\xED",disabled:!0}]),t(b.data),f.value={...b.data},r.value=!1}async function P(){console.log(e.value.filter(b=>!b.disabled))}function $(){d("close")}return K(()=>g()),(b,E)=>{const O=v("v-progress-circular"),z=v("v-btn"),C=v("v-form");return i(),h(A,null,[p("div",Oe,[p("div",{class:J([[r.value||"invisible"],"position-absolute w-100 h-100 d-flex justify-center align-center bg-overlay"])},[o(O,{indeterminate:"",size:50,width:5})],2)]),o(C,{"validate-on":"blur",modelValue:n.value,"onUpdate:modelValue":E[0]||(E[0]=F=>n.value=F),ref:"form",onSubmit:G(P,["prevent"]),class:"h-100"},{default:s(()=>[p("div",De,[p("div",null,[ze,p("div",Re,[p("span",Ue,y(l.collection.toUpperCase())+"_ID:",1),k(" "+y(l.id),1)])])]),p("div",Fe,[o(Ae,{fields:u(e)},null,8,["fields"])]),p("div",Te,[o(z,{variant:"plain",color:"grey-darken-5",class:"me-3",onClick:$},{default:s(()=>[k("Zru\u0161it")]),_:1}),o(z,{type:"submit",variant:"tonal","prepend-icon":"mdi-content-save-outline"},{default:s(()=>[k(" Ulo\u017Eit ")]),_:1})])]),_:1},8,["modelValue","onSubmit"])],64)}}}),Be={class:"font-weight-bold"},Le={class:"font-weight-bold"},Se=p("div",{class:"mb-5"},"Opravdu si p\u0159ejete trvale odstranit tyto u\u017Eivatele?",-1),je=p("div",{class:"mb-5"},"Opravdu si p\u0159ejete odhl\xE1sit tyto u\u017Eivatele?",-1),Me={class:"pa-7"},He=U({__name:"Users",setup(l){const{store:d,refresh:c}=oe("user",10),{items:a,page:t,selectedItems:e,selectedItem:r,loading:n}=N(d),{mdlRemove:f,mdlBulkRemove:g,remove:P,bulkRemove:$}=be("user",c,r,e),{mdlRevoke:b,mdlBulkRevoke:E,revoke:O,bulkRevoke:z}=xe(c,r,e),C=x(null);function F(S){C.value=S}function L(){C.value=null}return(S,_)=>{const m=v("v-chip"),T=v("v-pagination");return i(),w(le,{loading:u(n)},{default:s(()=>[o(Ve,{opened:C.value!==null,onClose:L},{default:s(()=>[C.value?(i(),w(Ie,{key:0,id:C.value,collection:"user",onClose:L},null,8,["id"])):B("",!0)]),_:1},8,["opened"]),o(j,R(u(f),{onAccept:u(P),title:"Odstranit u\u017Eivatele"}),{default:s(()=>[k(" Opravdu si p\u0159ejete trvale odstranit u\u017Eivatele "),p("span",Be,y(u(r).email),1),k("? ")]),_:1},16,["onAccept"]),o(j,R(u(b),{onAccept:u(O),title:"Odhl\xE1sit u\u017Eivatele"}),{default:s(()=>[k(" Opravdu si p\u0159ejete odhl\xE1sit u\u017Eivatele "),p("span",Le,y(u(r).email),1),k("? ")]),_:1},16,["onAccept"]),o(j,R(u(g),{onAccept:u($),title:`Odstranit u\u017Eivatele (${u(e).length}x)`}),{default:s(()=>[Se,(i(!0),h(A,null,D(u(e).map(V=>V.email),V=>(i(),w(m,{class:"me-2 mb-2",size:"small"},{default:s(()=>[k(y(V),1)]),_:2},1024))),256))]),_:1},16,["onAccept","title"]),o(j,R(u(E),{onAccept:u(z),title:`Odhl\xE1sit u\u017Eivatele (${u(e).length}x)`}),{default:s(()=>[je,(i(!0),h(A,null,D(u(e).map(V=>V.email),V=>(i(),w(m,{class:"me-2 mb-2",size:"small"},{default:s(()=>[k(y(V),1)]),_:2},1024))),256))]),_:1},16,["onAccept","title"]),p("div",Me,[o(se,{"breadcrumb-items":["U\u017Eivatel\xE9"],refresh:u(c)},null,8,["refresh"]),o(ke,{columns:[{name:"Role",key:"role",type:"string"},{name:"E-mail",key:"email",type:"email"},{name:"Posledn\xED p\u0159ihl\xE1\u0161en\xED",key:"lastLogin",type:"datetime"},{name:"Expirace tokenu",key:"loginExpiration",type:"datetime"},{name:"Posledn\xED \xFAprava",key:"updatedAt",type:"datetime"},{name:"Registrace",key:"createdAt",type:"datetime"}],"batch-actions":[{title:"Odhl\xE1sit u\u017Eivatele",handler:()=>u(E).toggleOpen("show")},{title:"Trvale odstranit",handler:()=>u(g).toggleOpen("show")}],"row-actions":[{title:"Odhl\xE1sit u\u017Eivatele",handler:()=>u(b).toggleOpen("show")},{title:"Trvale odstranit",handler:()=>u(f).toggleOpen("show")}],onGoToDetail:F},null,8,["batch-actions","row-actions"]),u(a).length?(i(),w(T,{key:0,modelValue:u(t).currentPage,"onUpdate:modelValue":_[0]||(_[0]=V=>u(t).currentPage=V),length:u(t).lastPage,"total-visible":5,class:"mt-5"},null,8,["modelValue","length"])):B("",!0)])]),_:1},8,["loading"])}}});export{He as default};
